# ğŸ”¥ Ember

**A health companion that notices when you're off â€” and says something.**

Most wellness apps drown you in data. Rings to close, streaks to maintain, dashboards to check. Ember does the opposite: it watches silently, learns your rhythms, and sends a single SMS when something seems off.

```
Ember:  skipping our run today?
You:    foot is killing me
Ember:  listen to your body â€” rest up
```

No app to open. No notifications. Just a text from something that noticed.

---

## What it does

Ember runs every morning. It reads your Apple Health data â€” sleep duration, wake time, workouts, resting heart rate â€” and compares today against your personal 30-day rolling baseline. If anything falls more than **2 standard deviations** from your norm, it texts you.

The message is generated by Claude claude-sonnet-4-6 with a tightly constrained prompt: under 10 words, warm, never clinical, never pushy. If you reply, Ember responds once and then goes quiet.

---

## Architecture

```
Apple Health export
        â”‚
        â–¼
  ember.py (Python)          â† parses XML, extracts daily metrics
        â”‚
        â–¼
  Ember Server (Node.js)     â† statistical anomaly detection
        â”‚
        â”œâ”€â”€ no anomaly â†’ done
        â”‚
        â””â”€â”€ anomaly detected
                â”‚
                â–¼
         Claude API          â† generates a warm, brief SMS
                â”‚
                â–¼
           Twilio            â† delivers the message
                â”‚
                â–¼
         you get a text
```

Inbound replies are handled via a Twilio webhook â†’ server reads conversation context â†’ Claude generates one reply â†’ thread closes for the day.

---

## Technical decisions worth explaining

**Why statistics, not AI, for anomaly detection**

The detection layer is plain math â€” rolling mean and standard deviation over 30 days, flagging at 2Ïƒ. I deliberately didn't use Claude here. LLMs are expensive to call at high frequency, non-deterministic, and harder to reason about. For "is this number unusual?", statistics are faster, cheaper, and more correct. Claude only touches the part it's genuinely better at: turning a dry anomaly descriptor into something that sounds human.

**Why 2 standard deviations**

1Ïƒ flags too much â€” you'd get texts constantly. 3Ïƒ is so rare it misses real disruptions. 2Ïƒ hits the sweet spot: unusual enough to be worth mentioning, common enough to be useful.

**Prompt constraints over prompt instructions**

The system prompt doesn't just tell Claude to "be brief" â€” it gives concrete examples, enforces a hard word count, and specifies what Claude must never do (ask follow-up questions, use medical language, keep the thread going). Behavioral constraints are more reliable than intentions.

**One reply, then silence**

Ember replies to your first response and then stops. The store tracks whether Ember has already replied in a given day's thread and ignores further messages. This prevents it from feeling like a chatbot and preserves the "quiet companion" character.

**No raw health data on the server**

The Python script processes the Apple Health XML locally. Only aggregated daily metrics (wake hour, sleep duration, etc.) are sent to the server. The server never sees raw sensor data.

---

## Stack

| Layer | Tech | Why |
|---|---|---|
| Health data | Apple HealthKit / Health export XML | Only source of Apple Watch data |
| Data pipeline | Python 3 | Simple, readable, no build step |
| Server | Node.js + Express | Lightweight, fast for I/O-bound work |
| Anomaly detection | Rolling stats (mean + SD) | Deterministic, interpretable, cheap |
| Message generation | Claude claude-sonnet-4-6 | Best-in-class for constrained natural language |
| SMS delivery | Twilio | Standard, reliable, webhooks for replies |
| Storage | JSON file (swap for Postgres) | Simple for a personal project |

---

## Running it yourself

```bash
# 1. Clone and set up the server
git clone https://github.com/your-username/ember
cd ember/server && npm install
cp .env.example .env  # add your Twilio + Anthropic keys
npm start

# 2. Export your Apple Health data
# Health app â†’ profile picture â†’ Export All Health Data â†’ save export.zip
# Unzip it â€” you want export.xml

# 3. First run: seed your baseline history
python ember.py --export ~/Downloads/export.xml --phone +1XXXXXXXXXX --seed

# 4. Every morning after that
python ember.py --export ~/Downloads/export.xml
```

Full setup guide: [docs/setup.md](docs/setup.md)

---

## What I'd build next

- Scheduled auto-export via a macOS Launch Agent so it runs without thought
- Postgres to replace the JSON store for multi-user use
- A proper iOS app with HealthKit background sync so the export step disappears
- Weekday vs. weekend baseline profiles
- Richer reply context so Ember can be more specific

---

## What I learned

Building Ember clarified something about agentic systems: the interesting design decisions aren't about which AI model to use â€” they're about **where** to use AI at all. The system works better because Claude is constrained to a single, narrow responsibility (natural language), while everything structural (scheduling, statistics, state management, conversation threading) is plain code that's easy to reason about and debug.

The other thing: behavioral constraints in prompts matter more than intentions. "Be brief" is aspirational. Giving examples, enforcing word counts, and listing explicit prohibitions is engineering.
